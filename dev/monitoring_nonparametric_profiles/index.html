<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Detecting Changes in Profiles · StatisticalProcessMonitoring.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://DedZago.github.io/StatisticalProcessMonitoring.jl/monitoring_nonparametric_profiles/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">StatisticalProcessMonitoring.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li><a class="tocitem" href="../theory/">Theory</a></li><li><a class="tocitem" href="../getting-started/">Getting started</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../monitoring_mean_covariance/">Jointly Monitoring the Mean and Covariance Using a Multi-Chart Scheme</a></li><li><a class="tocitem" href="../monitoring_autoregressive/">Residual-Based Monitoring of Autocorrelated Data</a></li><li><a class="tocitem" href="../monitoring_risk_adjusted/">Monitoring Surgical Outcomes Using a Risk-Adjusted CUSUM Chart</a></li><li class="is-active"><a class="tocitem" href>Detecting Changes in Profiles</a></li></ul></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="../statistics/">Monitoring statistics</a></li><li><a class="tocitem" href="../control_limits/">Control limits</a></li><li><a class="tocitem" href="../nominal_properties/">Nominal properties</a></li><li><a class="tocitem" href="../phase_2/">Phase 2</a></li><li><a class="tocitem" href="../control_charts/">Control charts</a></li><li><a class="tocitem" href="../optimization/">Optimization</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Detecting Changes in Profiles</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Detecting Changes in Profiles</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/DedZago/StatisticalProcessMonitoring.jl/blob/main/docs/src/monitoring_nonparametric_profiles.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Detecting-Changes-in-Profiles"><a class="docs-heading-anchor" href="#Detecting-Changes-in-Profiles">Detecting Changes in Profiles</a><a id="Detecting-Changes-in-Profiles-1"></a><a class="docs-heading-anchor-permalink" href="#Detecting-Changes-in-Profiles" title="Permalink"></a></h1><p>Here, we demonstrate how the <code>Phase2</code> type can be used to also work with structured data types. In this example, we consider monitoring profiles: $   Y = f_{tj} = f(x_{tj}) + \varepsilon_{ij}, \quad j = 1, 2, \ldots, n_t, $ where <span>$f(x_{tj})$</span> is the unknown function relating <span>$x_{tj}$</span> to <span>$Y_{tj}$</span>, <span>$\varepsilon_{ij} \sim F_\varepsilon$</span>, <span>$\mathbb{E}[\varepsilon_{ij}] = 0$</span>, and <span>$\mathbb{V}[\varepsilon_{ij}] = \sigma &gt; 0$</span> for all <span>$t$</span> and <span>$j$</span>.</p><p>Let&#39;s load the required packages,</p><pre><code class="language-julia hljs">using StatisticalProcessMonitoring, Distributions, Random, Loess, Plots, LaTeXStrings</code></pre><p>For simplicity, we assume equi-spaced <span>$\bm{x_t}$</span> in [0.5, 10] with increments of 0.5 for all <span>$t = -m+1, \ldots, 0, 1, 2, \ldots$</span>.</p><pre><code class="language-julia hljs">julia&gt; n = 500
julia&gt; nj = 20
julia&gt; x_grid = collect(0.5:0.5:10)
julia&gt; xs = Matrix{Float64}(undef, n, nj)
julia&gt; for i in 1:n; xs[i, :] = x_grid; end</code></pre><p>We generate an initial sample of 500 IC profiles from the functional process using the standard normal distribution for <span>$F_\varepsilon$</span>.</p><pre><code class="language-julia hljs">julia&gt; Random.seed!(41289355)
julia&gt; ys = sin.(xs) .+ randn(n, nj)</code></pre><p>We use the <code>FunctionalObservation</code> type to represent profile data. The package provides an alias for representing functional data as a collection of functional observations.</p><pre><code class="language-julia hljs">const FunctionalData{A,B} = Vector{FunctionalObservation{A,B}} where {A,B}</code></pre><p>We create a Phase II object for simulating run lengths for a functional control chart.</p><pre><code class="language-julia hljs">julia&gt; dat = FunctionalData(xs, ys)
julia&gt; PH2 = Phase2(Bootstrap(), dat)</code></pre><p>We use the nonparametric exponentially weighted moving average (NEWMA) control chart. The IC profile <span>$\widehat{f}$</span> is estimated using the LOESS estimator.</p><pre><code class="language-julia hljs">julia&gt; using Loess
julia&gt; g = loess(vec(xs), vec(ys), span = 0.3)
julia&gt; plt = plot(minimum(xs):0.01:maximum(xs), (x) -&gt; predict(g, x),
                  linewidth = 1.75, label = L&quot;\hat{f}(x)&quot;, xlab = L&quot;x&quot;, ylab = L&quot;y&quot;,
                  dpi = 300)
julia&gt; scatter!(plt, vec(xs), vec(ys), markersize = 1, label = &quot;&quot;,
                colour = &quot;black&quot;)</code></pre><p><img src="../figures/example-loess-ic.png" alt/></p><p>We define a NEWMA chart with smoothing parameter <span>$\lambda = 0.2$</span>.</p><pre><code class="language-julia hljs">julia&gt; STAT = NEWMA(0.2, g, dat)</code></pre><p>We use an upper decision interval with constant false-alarm rate and sequential estimation using 1000 bootstrap simulations.</p><pre><code class="language-julia hljs">julia&gt; LIM = OneSidedBootstrapLimit(STAT, true, 1000)</code></pre><p>We set the nominal in-control average run length to 500.</p><pre><code class="language-julia hljs">julia&gt; NM = ARL(500)
julia&gt; CH = ControlChart(STAT, LIM, NM, PH2)</code></pre><p>The NEWMA control chart is then applied to three sequences of Phase II data:</p><pre><code class="language-julia hljs">julia&gt; n2 = 150
julia&gt; xs_oc = xs[1:n2, :]
julia&gt; ys_ic = sin.(xs_oc) .+ randn(n2, nj)                  # In-control
julia&gt; ys_oc = sin.(xs_oc) + 2*cos.(xs_oc) .+ randn(n2, nj)  # Profile shift
julia&gt; ys_oc2 = sin.(xs_oc) .+ 2*randn(n2, nj)               # Variance shift</code></pre><p>The matrices containing the Phase II observations are converted to <code>FunctionalData</code> objects, which enables application of the control chart.</p><pre><code class="language-julia hljs">julia&gt; dat_ic = FunctionalData(xs_oc, ys_ic)
julia&gt; dat_oc = FunctionalData(xs_oc, ys_oc)
julia&gt; dat_oc2 = FunctionalData(xs_oc, ys_oc2)</code></pre><p>Once the <code>FunctionalData</code> objects are created, the control chart can be run on the three data sequences.</p><pre><code class="language-julia hljs">julia&gt; proc_ic = apply_chart(CH, dat_ic)
julia&gt; proc_oc = apply_chart(CH, dat_oc)
julia&gt; proc_oc2 = apply_chart(CH, dat_oc2)</code></pre><p>The results of applying the NEWMA control chart to the Phase II sequences are shown in Figure 1. The plots display the values of the NEWMA control chart for the three cases, with the control limits estimated and shown as a black dashed line. The control chart effectively detects changes in both the profile shift and variance shift. When the process is in control (IC), no change is detected by the control chart.</p><pre><code class="language-julia hljs">markersize = 1.5
plt1 = plot_series(proc_ic, marker = :d, title = &quot;In-control&quot;, l_linestyle = :dot,
                    markersize = markersize, dpi = 300, label = &quot;&quot;, xlab = L&quot;t&quot;, ylab = L&quot;C_t&quot;)
plt2 = plot_series(proc_oc, marker = :o, title = &quot;Profile shift&quot;,l_linestyle = :dot,
                    markersize = markersize, dpi = 300, colour = palette(:tab10)[2],
                    label = &quot;&quot;, xlab = L&quot;t&quot;, ylab = L&quot;C_t&quot;)
plt3 = plot_series(proc_oc2, marker = :square, title = &quot;Variance shift&quot;, l_linestyle = :dot,
                    markersize = markersize, dpi = 300, colour = palette(:tab10)[3],
                    label = &quot;&quot;, xlab = L&quot;t&quot;, ylab = L&quot;C_t&quot;)
l = @layout [grid(1,2); _{0.2w} c{0.55w} _{0.25w}]
plt = plot(plt1,plt2,plot(frame = :none), plt3; layout = l)</code></pre><p><img src="../figures/example-loess-chart.png" alt/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../monitoring_risk_adjusted/">« Monitoring Surgical Outcomes Using a Risk-Adjusted CUSUM Chart</a><a class="docs-footer-nextpage" href="../statistics/">Monitoring statistics »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Thursday 16 May 2024 15:03">Thursday 16 May 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
